// hooks/useLpSearch.ts
import { useInfiniteQuery } from '@tanstack/react-query';
import { api } from '../api/client';
import type { Lp } from '../types/lp.types';

interface SearchResponse {
  items: Lp[];
  nextCursor: string | null;
  hasMore: boolean;
}

export const useLpSearch = (query: string) => {
  return useInfiniteQuery<SearchResponse>({
    queryKey: ['lpSearch', query],
    queryFn: async ({ pageParam = null }) => {
      const params = new URLSearchParams();
      if (query) params.append('q', query);
      if (pageParam) params.append('cursor', pageParam as string);
      
      const response = await api.get(`/lp/search?${params.toString()}`);
      return response.data;
    },
    getNextPageParam: (lastPage) => lastPage.nextCursor,
    enabled: query.trim().length > 0, // 빈 문자열일 때 요청 방지
    staleTime: 1000 * 60 * 5, // 5분간 캐시 유지
    gcTime: 1000 * 60 * 10, // 10분간 가비지 컬렉션 대기
  });
};